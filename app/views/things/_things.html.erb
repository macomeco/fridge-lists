<% things.each do |tng| %>
    <%if list_id == tng.list_id then%>
        <%=content_tag(:div,'', class:'target-card card mb-2',style:'border-color:'+@theme.clr_font) do %>    
            
            <div class="row no-gutters">
                
                <div class="col-md-1 px-auto">
                    <%= content_tag(:div,'',style: 'background-color:'+ @clr, class:'h-100 d-flex align-items-center ') do %>
                        <div class='text-center w-100'>
                            <a style="top:50%">
                                <%= link_to tng , :method => :delete, data:{ confirm: tng.content+'を削除しますか？'},class: 'w-100 h-100',style: 'color:'+@theme.clr_sub do %><i class="fa fa-check fa-sm"></i>
                            </a>
                            <% end %>
                        </div>
                    <%end%>
                </div>
            
                <div class="col-md-6">
                    <div class="card-body pl-3 pr-0 py-3">
                        <div style="text-align:left;font-size:14px;">
                            <p class="m-0"><%= tng.content %></p>
                            <% if Tag.all.find_by(id: tng.tag_id) == nil then %>
                            <%else%>
                                <% @tag_name = Tag.all.find(tng.tag_id).name%>
                                <%= content_tag(:p, '#'+@tag_name ,style:'font-size:10px;color:'+@theme.clr_font ,class:'text-muted m-0 mt-1') %>
                            <%end%>
                            
                            <% num = (tng.deadline-Date.today).to_i %>
                        </div>
                    </div>
                </div>

            
                <div class="col-md-3 pr-1">
                    <div class='h-100 d-flex align-items-center'%>
                        <div class=' w-100'>
                            
                            <div style="float:right;">
                        
                                <div style="font-size:10px">
                                    <%if num > 0 %>
                                        あと <a style="font-size:14px"><%= num %></a> 日
                                    <% elsif num == 0 %>
                                        <a style="font-size:13px">当日</a>
                                    <%else%>
                                        <a style="font-size:14px"><%= num.abs %></a> 日 経過
                                    <%end%>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-2 px-auto">
                    <div class='h-100 d-flex align-items-center'%>
                        <div class='text-center w-100'>
                            <%= content_tag(:div,'', style: 'color:'+@theme.clr_main ,class: 'tng-edit text-right btn btn-link p-0')do %><i class="fas fa-pen "></i><%end%>
                        </div>
                    </div>
                </div>
                
            </div>
            
        <%end%>
        
        <%= content_tag(:div,'',style:'border-color:'+@theme.clr_font ,class:'card mb-2 p-0 tng-edit-form') do %>
            <div class="card-body">
                <%= form_with(model: tng, local: true)do |f| %>
                
                <div class="input-group input-group-sm mt-1">
                    <div class="input-group-prepend">
                        <span class="input-group-text input-group-sm">
                            <%= f.label :list_id, 'お部屋',class:'m-0'%>
                        </span>
                    </div>
                    <%= f.collection_select :list_id, List.all,:id,:name,{} ,class: 'form-control' %>
                </div>
                
                <div class="input-group input-group-sm my-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text input-group-sm">
                            <%= f.label :content, '&ensp;もの&ensp;'.html_safe,class:'m-0' %>
                        </span>
                    </div>
                    <%= f.text_field :content, class: 'form-control'%>
                </div>
                
                <div class="input-group input-group-sm my-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text input-group-sm">
                            <%= f.label :deadline, '&ensp;期限&ensp;'.html_safe,class:'m-0' %>
                            </br>
                        </span>
                    </div>
                    <%= f.date_field :deadline,  class: 'form-control '%>
                </div>
                
                <div class="input-group input-group-sm my-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text input-group-sm">
                            <%= f.label :tag_id, '&ensp;タグ&ensp;'.html_safe ,class:'m-0'%>
                            </br>
                        </span>
                    </div>
                    <%= f.collection_select :tag_id, Tag.all,:id,:name,{},class: 'form-control'%>
                </div>
                
                <div class="text-right">
                    <%= f.submit 'OK' , class: 'btn btn-success ml-2 btn-sm',style: 'background-color:'+@theme.clr_sub+';color:'+@theme.clr_font+';border-color:'+@theme.clr_font %>
                    <%end%>
                </div>
            </div>
        <%end%>

    <%end%>
<%end%>
<script>

$('.tng-edit-form').css('display','none');
$('.tng-edit').on('click',function(){
    $(this).parents('.target-card').nextAll('.tng-edit-form:first').stop().slideToggle();
    //$('.tng-edit-form').not($(this)).slideUp();
    $('.tag-edit-form').not($(this)).css('background-color','red');

});
    
</script>