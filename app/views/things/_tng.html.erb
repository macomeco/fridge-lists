<% @no -= 1 %>

<% if @no == 0 %>
<% @m = 'mb-0' %>
<%else%>
<% @m = 'mb-2'%>
<%end%>

<%=content_tag(:div,'', class:'target-card card clr_font_bd clr_font_c '+@m) do %>
<% cache tng.updated_at ,expires_in: 30.minutes do%>

    <div class="tng-main row no-gutters">
        <%# ✓ %>
        <div class="col-1 px-auto w-100">
            <%if @clr_flag == true then%>
                <div class="w-100 h-100 d-flex align-items-center clr_list_i_b">
            <%elsif @clr_flag == false then%>
                <div class="w-100 h-100 d-flex align-items-center clr_list_ii_b">
            <%end%>
                <%= link_to tng , :method => :delete, data:{ confirm: tng.content+'を削除しますか？'},class: 'clr_sub_c text-center w-100' do %><i class="fa fa-check fa-sm"></i><%end%>
            </div>
        </div>
        <%#メイン%>
        <div class="col-6 w-100 pr-0 pl-2"style="padding: 0.56rem;">
            <div class="h-100 ml-1">
            <p class="m-0" style='font-size:15.5px'><%= tng.content %></p>
            <% unless tng.tag_id == nil then %>
                <%= content_tag(:p, '#'+@tags.find(tng.tag_id).name ,style:'font-size:11px' ,class:'mt-1 mb-0') %>
            <%end%>
            </div>
        </div>

        <div class="col-3 px-auto w-100 py-3 pr-1">
            <div class="h-100 d-flex align-items-center" style="float:right;">
            
                <div style="font-size:10px">
                    <% num = (tng.deadline-@today).to_i %>
                    <%if num > 0 %>
                        あと <a style="font-size:14px"><%= num %></a> 日
                    <% elsif num == 0 %>
                        <p class=" m-0 clr_point_c" style="font-size:14px;font-weight: bold;">当日</p>
                    <%else%>
                        <a style="font-size:14px"><%= num.abs %></a> 日 経過
                    <%end%>
                </div>
            </div>
        </div>
        
        <div class="col-2 px-auto w-100 py-3">
            <div class="h-100 d-flex align-items-center">
                <div class="tng-edit text-center w-100">
                    <%if @clr_flag == true then%>
                        <div class="w-100 text-center btn btn-link p-0 clr_list_i_c">
                    <%elsif @clr_flag == false then %>
                        <div class="w-100 text-center btn btn-link p-0 clr_list_ii_c">
                    <%end%>
                        <i class="fas fa-pen"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row no-gutters tng-edit-form ">
        <div class="col-1 px-auto w-100">
            <%if @clr_flag == true then%>
                <div class="h-100 d-flex align-items-center clr_list_i_b"></div>
            <%elsif @clr_flag == false then %>
                <div class="h-100 d-flex align-items-center clr_list_ii_b"></div>
            <%end%>
        </div>
        
        <div class="col-11">
            <div class="w-100 pb-3 px-3 pt-1">
                
                <%= form_with(model: tng, local: true)do |f| %>
                    
                    <div class="input-group input-group-sm mt-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text input-group-sm">
                                <%= f.label :list_id, 'お部屋',class:'m-0'%>
                            </span>
                        </div>
                        <%= f.collection_select :list_id, @list_w,:id,:name,{} ,class: 'form-control' %>
                    </div>
                    
                    <div class="input-group input-group-sm my-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text input-group-sm">
                                <%= f.label :content, '&ensp;もの&ensp;'.html_safe,class:'m-0' %>
                            </span>
                        </div>
                        <%= f.text_field :content, class: 'form-control'%>
                    </div>
                    
                    <div class="input-group input-group-sm my-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text input-group-sm">
                                <%= f.label :deadline, '&ensp;期限&ensp;'.html_safe,class:'m-0' %>
                                </br>
                            </span>
                        </div>
                        <%= f.date_field :deadline,  class: 'form-control '%>
                    </div>
                    
                    <div class="input-group input-group-sm my-2">
                        <div class="input-group-prepend">
                            <span class="input-group-text input-group-sm">
                                <%= f.label :tag_id, '&ensp;タグ&ensp;'.html_safe ,class:'m-0'%>
                                </br>
                            </span>
                        </div>
                        <%= f.collection_select :tag_id, @tag_w ,:id,:name,{},class: 'form-control'%>
                    </div>
                    <div>
                    <%#<%= f.number_field :quantity, value:1 ,class: 'form-control',style: "visibility:hidden;"%>
                    </div>
                    <div class="text-right">
                        <%= f.submit 'OK' , class: 'btn ml-2 btn-sm clr_sub_b clr_font_c clr_font_bd' %>
                    </div>
                
                <%end%>
            
            </div>            
        </div>                   
    </div>

<%end%>
<%end%>

<script>
$('.tng-edit-form').hide();
</script>
